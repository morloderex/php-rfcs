DateTime And Daylight Saving Time Transitions
=============================================

:PHP-RFC: 0130
:Title: DateTime And Daylight Saving Time Transitions
:Author: Daniel Convissor <danielc@php.net>, with feedback from Derick Rethans <derick@php.net>
:Status: Accepted
:Type: Unknown
:Created: 2011-10-18
:Version: 1.0

Introduction
------------

PHP's DateTime class has unexpected outcomes when dealing with the
transitions between Daylight Saving Time and Standard Time.

Properly defining, documenting and unit testing DateTime's behaviors is
important for PHP's future. This document seeks agreement on what the
expected behaviors should be.

Getting these issues straightened out before 5.4 goes into Release
Candidate status seems wise.

Zone Types
----------

PHP uses three different time zone data structures internally.

Zone Type 3 objects contain the transition data required for proper
calculations around the Daylight/Standard time changes.

Zone Type 1 and 2 objects just know their offset from UTC, so addition
and subtraction on them ignore crossing over Daylight/Standard
thresholds.

This RFC focuses on the changes needed to make Zone Type 3 work in a
comprehensive manner. Zone Type 1 and 2 behaviors are covered to clarify
their expected behavior.

Examples
~~~~~~~~

Examples of how to create DateTime objects containing each zone type:

Zone Type 1: Offset
^^^^^^^^^^^^^^^^^^^

.. code:: php

   $d = new DateTime('2011-09-13 14:15:16 -0400');

Zone Type 2: Abbreviation
^^^^^^^^^^^^^^^^^^^^^^^^^

.. code:: php

   $d = new DateTime('2011-09-13 14:15:16 EDT');

Zone Type 3: ID
^^^^^^^^^^^^^^^

.. code:: php

   $d = new DateTime('2011-09-13 14:15:16');
   // or
   $d = new DateTime('2011-09-13 14:15:16', new DateTimeZone('America/New_York'));

Time Zone for Sake of Discussion
--------------------------------

The ``America/New_York`` time zone will be used for demonstration
purposes. The Standard/Daylight transition in this zone happens at 2:00
am. The forward transition (in spring) jumps to 3:00 am, skipping over
the hour of 2 am. The backward transition (in fall) jumps back to 1:00
am, repeating the hour of 1 am.

Other time zone changes have different lengths of time and take effect
at different days/times.

Construction During Transitions
-------------------------------

Forward Transitions
~~~~~~~~~~~~~~~~~~~

Times between ``2:00:00 am`` and ``2:59:59 am`` do not exist during the
Forward Transitions transition. Attempts to create such times should be
rounded forward, like PHP currently does when trying to create February
29th on a non-leap year.

.. code:: php

   date_default_timezone_set('America/New_York');
   $date = new DateTime('2010-03-14 02:30:00');
   echo $date->format('Y-m-d H:i:s T') . "\n";
   // Expected: 2010-03-14 03:30:00 EDT
   // Actual:   2010-03-14 02:30:00 EDT

Backward Transitions
~~~~~~~~~~~~~~~~~~~~

PHP needs a means to create objects representing times during the hour
repeated on the Daylight/Standard transition day (between ``1:00:00 am``
and ``1:59:59 am`` Standard Time).

This RFC proposes adjusting the time string parser to handle strings
containing ``DST`` and ``ST``. When ``DST`` or ``ST`` are not present,
PHP will use the current behavior, which uses the time zone offset in
place at the specified time and uses DST offset during the repeated hour
during backward transitions.

Force Daylight Saving Time:

.. code:: php

   date_default_timezone_set('America/New_York');
   $date = new DateTime('2010-11-07 01:30:00 DST');
   echo $date->format('Y-m-d H:i:s T') . "\n";
   // Expected: 2010-11-07 01:30:00 EDT

Force Standard Time:

.. code:: php

   date_default_timezone_set('America/New_York');
   $date = new DateTime('2010-11-07 01:30:00 ST');
   echo $date->format('Y-m-d H:i:s T') . "\n";
   // Expected: 2010-11-07 01:30:00 EST

Default to Daylight Time during repeated hour, PHP's current behavior:

.. code:: php

   date_default_timezone_set('America/New_York');
   $date = new DateTime('2010-11-07 01:30:00');
   echo $date->format('Y-m-d H:i:s T') . "\n";
   // Expected & Actual: 2010-11-07 01:30:00 EDT

The ``ST`` or ``DST`` modifiers can only be used when specifying times
during the backward transition period. Using the modifiers at other
times will throw an exception in object-oriented style code while
procedural style code will return false without triggering errors.

Math
----

The date format used in this section is for display purposes only, does
not correspond to a PHP format, nor is intended to be parsed by PHP.

Reminder: the time zone in the examples is ``America/New_York``. So
"(ST)" represents Eastern Standard Time/EST/-0500 and "(DT)" represents
Eastern Daylight Time/EDT/-0400.

The behaviors indicated here are covered by unit tests in
``ext/date/tests``:

-  rfc-datetime_and_daylight_saving_time-type1.phpt
-  rfc-datetime_and_daylight_saving_time-type2.phpt
-  rfc-datetime_and_daylight_saving_time-type3.phpt

Each output line in the test files is prefixed with an identifier that
corresponds to the ``phpt`` columns in the tables below.

Actual results for Zone Types 1 and 2 are shown as ``N/A`` for the
moment. All Zone Type 1 tests pass. Zone Type 2 results are tainted by
`Bug 55253 <https://bugs.php.net/bug.php?id=55253>`__.

.. _forward-transitions-1:

Forward Transitions
~~~~~~~~~~~~~~~~~~~

Zone Type 3
^^^^^^^^^^^

diff()
''''''

+----------------+----------------+----------+------+----------------+
| End            | Start          | Expected | phpt | Actual (if     |
|                |                |          |      | wrong)         |
+================+================+==========+======+================+
| ``2            | ``2            | PT0H0M1S | fd1  | PT1H0M1S       |
| 010-03-14T03:0 | 010-03-14T01:5 |          |      |                |
| 0:00``\ *(DT)* | 9:59``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | fd2  |                |
| 010-03-14T04:3 | 010-03-13T04:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT22H  | fd3  | P0DT23H        |
| 010-03-14T03:3 | 010-03-13T04:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT21H  | fd4  |                |
| 010-03-14T01:3 | 010-03-13T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | fd5  |                |
| 010-03-14T01:3 | 010-03-13T01:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | fd6  |                |
| 010-03-14T03:3 | 010-03-13T03:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT1H   | fd7  |                |
| 010-03-14T03:3 | 010-03-13T02:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+

add()
'''''

+----------------+----------+----------------+------+----------------+
| Start          | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | fa1  |                |
| 010-03-14T01:5 |          | 010-03-14T03:0 |      |                |
| 9:59``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fa2  |                |
| 010-03-13T04:3 |          | 010-03-14T04:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | fa3  |                |
| 010-03-13T04:3 |          | 010-03-14T03:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | fa4  |                |
| 010-03-13T04:3 |          | 010-03-14T01:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fa5  |                |
| 010-03-13T01:3 |          | 010-03-14T01:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fa6  |                |
| 010-03-13T02:3 |          | 010-03-14T02:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+

sub()
'''''

+----------------+----------+----------------+------+----------------+
| End            | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | fs1  | ``2            |
| 010-03-14T03:0 |          | 010-03-14T01:5 |      | 010-03-14T03:5 |
| 0:00``\ *(DT)* |          | 9:59``\ *(ST)* |      | 9:59``\ *(DT)* |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs2  |                |
| 010-03-14T04:3 |          | 010-03-13T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | fs3  | ``2            |
| 010-03-14T03:3 |          | 010-03-13T04:3 |      | 010-03-13T05:3 |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | fs4  |                |
| 010-03-14T01:3 |          | 010-03-13T04:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs5  |                |
| 010-03-14T01:3 |          | 010-03-13T01:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs6  |                |
| 010-03-15T03:3 |          | 010-03-14T03:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs7  |                |
| 010-03-15T02:3 |          | 010-03-14T03:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+

Zone Types 1 & 2
^^^^^^^^^^^^^^^^

.. _diff-1:

diff()
''''''

+----------------+----------------+----------+------+----------------+
| End            | Start          | Expected | phpt | Actual (if     |
|                |                |          |      | wrong)         |
+================+================+==========+======+================+
| ``2            | ``2            | PT0H0M1S | fd1  |                |
| 010-03-14T03:0 | 010-03-14T01:5 |          |      |                |
| 0:00``\ *(DT)* | 9:59``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT23H  | fd2  |                |
| 010-03-14T04:3 | 010-03-13T04:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT22H  | fd3  |                |
| 010-03-14T03:3 | 010-03-13T04:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT21H  | fd4  |                |
| 010-03-14T01:3 | 010-03-13T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | fd5  |                |
| 010-03-14T01:3 | 010-03-13T01:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT23H  | fd6  |                |
| 010-03-14T03:3 | 010-03-13T03:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | fd7  |                |
| 010-03-14T03:3 | 010-03-13T02:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(ST)* |          |      |                |
+----------------+----------------+----------+------+----------------+

.. _add-1:

add()
'''''

+----------------+----------+----------------+------+----------------+
| Start          | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | fa1  | N/A            |
| 010-03-14T01:5 |          | 010-03-14T02:0 |      |                |
| 9:59``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fa2  | N/A            |
| 010-03-13T04:3 |          | 010-03-14T04:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | fa3  | N/A            |
| 010-03-13T04:3 |          | 010-03-14T02:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | fa4  | N/A            |
| 010-03-13T04:3 |          | 010-03-14T01:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fa5  | N/A            |
| 010-03-13T01:3 |          | 010-03-14T01:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fa6  | N/A            |
| 010-03-13T02:3 |          | 010-03-14T02:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+

.. _sub-1:

sub()
'''''

+----------------+----------+----------------+------+----------------+
| End            | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | fs1  | N/A            |
| 010-03-14T03:0 |          | 010-03-14T02:5 |      |                |
| 0:00``\ *(DT)* |          | 9:59``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs2  | N/A            |
| 010-03-14T04:3 |          | 010-03-13T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | fs3  | N/A            |
| 010-03-14T03:3 |          | 010-03-13T05:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | fs4  | N/A            |
| 010-03-14T01:3 |          | 010-03-13T04:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs5  | N/A            |
| 010-03-14T01:3 |          | 010-03-13T01:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs6  | N/A            |
| 010-03-15T03:3 |          | 010-03-14T03:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | fs7  | N/A            |
| 010-03-15T02:3 |          | 010-03-14T02:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+

.. _backward-transitions-1:

Backward Transitions
~~~~~~~~~~~~~~~~~~~~

.. _zone-type-3-1:

Zone Type 3
^^^^^^^^^^^

.. _diff-2:

diff()
''''''

+----------------+----------------+----------+------+----------------+
| End            | Start          | Expected | phpt | Actual (if     |
|                |                |          |      | wrong)         |
+================+================+==========+======+================+
| ``2            | ``2            | PT0H0M1S | bd1  | PT0H59M59S     |
| 010-11-07T01:0 | 010-11-07T01:5 |          |      |                |
| 0:00``\ *(ST)* | 9:59``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | bd2  |                |
| 010-11-07T04:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT24H  | bd3  | P0DT23H        |
| 010-11-07T03:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT23H  | bd4  | P0DT22H        |
| 010-11-07T02:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT22H  | bd5  | P0DT21H        |
| 010-11-07T01:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT21H  | bd6  |                |
| 010-11-07T01:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | bd7  |                |
| 010-11-07T01:3 | 010-11-06T01:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT1H   | bd8  | P1DT1H         |
| 010-11-07T01:3 | 010-11-06T01:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+

.. _add-2:

add()
'''''

+----------------+----------+----------------+------+----------------+
| Start          | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | ba1  | ``2            |
| 010-11-07T01:5 |          | 010-11-07T01:0 |      | 010-11-07T01:0 |
| 9:59``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba2  |                |
| 010-11-06T04:3 |          | 010-11-07T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT24H    | ``2            | ba3  | ``2            |
| 010-11-06T04:3 |          | 010-11-07T03:3 |      | 010-11-07T04:3 |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT23H    | ``2            | ba4  | ``2            |
| 010-11-06T04:3 |          | 010-11-07T02:3 |      | 010-11-07T03:3 |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | ba5  | ``2            |
| 010-11-06T04:3 |          | 010-11-07T01:3 |      | 010-11-07T02:3 |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | ba6  |                |
| 010-11-06T04:3 |          | 010-11-07T01:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba7  |                |
| 010-11-06T01:3 |          | 010-11-07T01:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1DT1H   | ``2            | ba8  | ``2            |
| 010-11-06T01:3 |          | 010-11-07T01:3 |      | 010-11-07T02:3 |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT25H    | ``2            | ba9  | ``2            |
| 010-11-06T04:3 |          | 010-11-07T04:3 |      | 010-11-07T05:3 |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      | 0:00``\ *(ST)* |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba10 |                |
| 010-11-06T03:3 |          | 010-11-07T03:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba11 |                |
| 010-11-06T02:3 |          | 010-11-07T02:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+

.. _sub-2:

sub()
'''''

+----------------+----------+----------------+------+----------------+
| End            | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | bs1  | ``2            |
| 010-11-07T01:0 |          | 010-11-07T01:5 |      | 010-11-07T00:5 |
| 0:00``\ *(ST)* |          | 9:59``\ *(DT)* |      | 9:59``\ *(DT)* |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs2  |                |
| 010-11-07T04:3 |          | 010-11-06T04:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT24H    | ``2            | bs3  | ``2            |
| 010-11-07T03:3 |          | 010-11-06T04:3 |      | 010-11-06T03:3 |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      | 0:00``\ *(DT)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT23H    | ``2            | bs4  | ``2            |
| 010-11-07T02:3 |          | 010-11-06T04:3 |      | 010-11-06T03:3 |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      | 0:00``\ *(DT)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | bs5  | ``2            |
| 010-11-07T01:3 |          | 010-11-06T04:3 |      | 010-11-06T03:3 |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      | 0:00``\ *(DT)* |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | bs6  |                |
| 010-11-07T01:3 |          | 010-11-06T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs7  |                |
| 010-11-07T01:3 |          | 010-11-06T01:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1DT1H   | ``2            | bs8  |                |
| 010-11-07T01:3 |          | 010-11-06T00:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs9  |                |
| 010-11-07T03:3 |          | 010-11-06T03:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs10 |                |
| 010-11-07T02:3 |          | 010-11-06T02:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+

.. _zone-types-1-2-1:

Zone Types 1 & 2
^^^^^^^^^^^^^^^^

.. _diff-3:

diff()
''''''

+----------------+----------------+----------+------+----------------+
| End            | Start          | Expected | phpt | Actual (if     |
|                |                |          |      | wrong)         |
+================+================+==========+======+================+
| ``2            | ``2            | PT0H0M1S | bd1  |                |
| 010-11-07T01:0 | 010-11-07T01:5 |          |      |                |
| 0:00``\ *(ST)* | 9:59``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT1H   | bd2  |                |
| 010-11-07T04:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | bd3  |                |
| 010-11-07T03:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT23H  | bd4  |                |
| 010-11-07T02:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT22H  | bd5  |                |
| 010-11-07T01:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P0DT21H  | bd6  |                |
| 010-11-07T01:3 | 010-11-06T04:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT0H   | bd7  |                |
| 010-11-07T01:3 | 010-11-06T01:3 |          |      |                |
| 0:00``\ *(DT)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+
| ``2            | ``2            | P1DT1H   | bd8  |                |
| 010-11-07T01:3 | 010-11-06T01:3 |          |      |                |
| 0:00``\ *(ST)* | 0:00``\ *(DT)* |          |      |                |
+----------------+----------------+----------+------+----------------+

.. _add-3:

add()
'''''

+----------------+----------+----------------+------+----------------+
| Start          | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | ba1  | N/A            |
| 010-11-07T01:5 |          | 010-11-07T02:0 |      |                |
| 9:59``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba2  | N/A            |
| 010-11-06T04:3 |          | 010-11-07T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT24H    | ``2            | ba3  | N/A            |
| 010-11-06T04:3 |          | 010-11-07T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT23H    | ``2            | ba4  | N/A            |
| 010-11-06T04:3 |          | 010-11-07T03:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | ba5  | N/A            |
| 010-11-06T04:3 |          | 010-11-07T02:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | ba6  | N/A            |
| 010-11-06T04:3 |          | 010-11-07T01:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba7  | N/A            |
| 010-11-06T01:3 |          | 010-11-07T01:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1DT1H   | ``2            | ba8  | N/A            |
| 010-11-06T01:3 |          | 010-11-07T02:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT25H    | ``2            | ba9  | N/A            |
| 010-11-06T04:3 |          | 010-11-07T05:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba10 | N/A            |
| 010-11-06T03:3 |          | 010-11-07T03:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | ba11 | N/A            |
| 010-11-06T02:3 |          | 010-11-07T02:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+

.. _sub-3:

sub()
'''''

+----------------+----------+----------------+------+----------------+
| End            | Interval | Expected       | phpt | Actual (if     |
|                |          |                |      | wrong)         |
+================+==========+================+======+================+
| ``2            | PT1S     | ``2            | bs1  | N/A            |
| 010-11-07T01:0 |          | 010-11-07T00:5 |      |                |
| 0:00``\ *(ST)* |          | 9:59``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs2  | N/A            |
| 010-11-07T04:3 |          | 010-11-06T04:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT24H    | ``2            | bs3  | N/A            |
| 010-11-07T03:3 |          | 010-11-06T03:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT23H    | ``2            | bs4  | N/A            |
| 010-11-07T02:3 |          | 010-11-06T03:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT22H    | ``2            | bs5  | N/A            |
| 010-11-07T01:3 |          | 010-11-06T03:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | PT21H    | ``2            | bs6  | N/A            |
| 010-11-07T01:3 |          | 010-11-06T04:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs7  | N/A            |
| 010-11-07T01:3 |          | 010-11-06T01:3 |      |                |
| 0:00``\ *(DT)* |          | 0:00``\ *(DT)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1DT1H   | ``2            | bs8  | N/A            |
| 010-11-07T01:3 |          | 010-11-06T00:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs9  | N/A            |
| 010-11-07T03:3 |          | 010-11-06T03:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+
| ``2            | P1D      | ``2            | bs10 | N/A            |
| 010-11-07T02:3 |          | 010-11-06T02:3 |      |                |
| 0:00``\ *(ST)* |          | 0:00``\ *(ST)* |      |                |
+----------------+----------+----------------+------+----------------+

Other Issues?
-------------

If you know of other problems, please bring them to the attention of the
authors.

Changelog
---------

Additional Metadata
-------------------

:Original Authors: Daniel Convissor danielc@php.net with feedback from Derick Rethans derick@php.net
:Original Status: Accepted (`voting results <https://wiki.php.net/rfc/datetime_and_daylight_saving_time/vote>`__)
:Slug: datetime_and_daylight_saving_time
:Wiki URL: https://wiki.php.net/rfc/datetime_and_daylight_saving_time
