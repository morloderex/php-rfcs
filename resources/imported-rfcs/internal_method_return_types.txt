====== PHP RFC: Add return type declarations for internal methods ======
  * Date: 2021-03-06
  * Author: Máté Kocsis <kocsismate@php.net>
  * Status: Draft
  * Implementation: https://github.com/php/php-src/pull/6548

===== Introduction =====

PHP 8.0 added parameter and return type declarations for the vast majority of functions and methods ([[https://github.com/php/php-src/pulls?q=is%3Apr+label%3AStubs+is%3Aclosed|Stubs initiative]]) because the different variance-related RFCs, as well as the  [[rfc:consistent_type_errors|PHP RFC: Consistent type errors for internal functions]], the [[rfc:union_types_v2|PHP RFC: Union Types 2.0]], and the [[rfc:mixed_type_v2|PHP RFC: Mixed Type v2]] RFCs made it possible to cover 99% of the cases. However, type information is still missing:
  * **When a type includes resources:** it's not possible to declare types containing resources as there is no ''resource'' type declaration. However, resources are currently being phased out ([[https://github.com/php/php-tasks/issues/6|Resource to object migration]]), so there are less and less of such type declarations every day.
  * **When a function or method doesn't parse parameters according to the "standard" way:** It can happen e.g. when a function or method doesn't respect the strict_types mode. PHP 8.0 fixed lots of such issues, but around 250 parameters are still not parsed correctly, due to various reasons. These could be fixed individually in the future.
  * **For ''out'' pass-by-ref parameters**: the type of these parameters is not validated during ZPP, thus it would be incorrect to declare any types. An in/out parameter RFC could fix this issue.
  * **For return types of all non-final methods**: According to the covariance rules, return types can't be added to overridden methods without a BC break due to the incompatible signature error doing so would result it. As all non-final internal methods are possibly overridden, the PHP project leaders decided not to cause such a big BC break yet.

The current RFC tries to tackle the last category by providing a longer term, granular migration path for users.

<code php>
</code>

===== Proposal =====


===== Backward Incompatible Changes =====


===== Vote =====

Add return type declarations for internal methods? The vote requires 2/3 majority to be accepted.