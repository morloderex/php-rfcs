====== PHP RFC: Add SameSite cookie attribute parameter ======

  * Version: 0.1
  * Date: 2022-11-16
  * Author: George Peter Banyard, <girgias@php.net>
  * Status: Under Discussion
  * Target Version: PHP 8.3
  * Implementation: [[https://github.com/php/php-src/pull/7546]]
  * First Published at: [[http://wiki.php.net/rfc/same-site-parameter]]

===== Introduction =====

The support for the SameSite cookie attribute has been added in PHP 7.3.
However, it can only be set by passing an array of options with the ''"samesite"'' key defied to the chosen value, this contrasts with all the other attributes.

This RFC proposes to add a SameSite parameter to all relevant functions.

==== Background and Motivation ====

Support for the SameSite attribute was added in https://wiki.php.net/rfc/same-site-cookie, the vote was split between two implementations, the one which was implemented, changing the 3rd argument to accept an array of optional attributes referenced by keys, and adding a SameSite parameter.

The proposal to add a SameSite parameter was unanimously declined, however, we believe this proposal should be revisited as PHP has changed and gained additional capabilities since version 7.3.

One of the primary arguments against adding a parameter is that the function already has 6 optional parameters, and attempting to set the SameSite attribute would require providing all the other optional parameters.
However, with the introduction of named arguments in PHP 8.0 this is no more an issue.

Moreover, parameters provide the benefit of type declarations, which can eliminate sources of bugs via the use of static analysis.

===== Proposal =====

The proposal consists of two part.
First, add the following enumeration:

<PHP>
enum SameSite {
    case None;
    case Lax;
    case Strict;
}
</PHP>

Which contains the 3 valid values for the SameSite attribute https://httpwg.org/http-extensions/draft-ietf-httpbis-rfc6265bis.html#name-the-samesite-attribute

Secondly, add a <php>SameSite $sameSite = SameSite::Lax</php> parameter to:

  * <php>setcookie()</php>
  * <php>setrawcookie()</php>
  * <php>session_set_cookie_params()</php>
 
Moreover, if attempting to set the SameSite attribute to None, the Secure attribute must be set, otherwise a ValueError will be raised.
This behaviour aligns will REFERENCE TO RFC 6265bis (or other) SECTION

==== Implementation details ====

Currently, if an invalid or no SameSite attribute is set, the Set-Cookie header is emit without the Default value and uses the default behaviour, which used to be ''SameSite:None'' but is being replaced by ''SameSite:Lax'' in the IETF RFC 6265bis Cookies: HTTP State Management Mechanism draft, and this behavioural change has started in some user agents.

As it is recommended to set this attribute, we align the default value with the draft internet standard.
But to preserve BC at this stage, the default function value of Lax is not enforced.
This would be similar to making this parameter nullable and accepting null,
however, doing as such is undesirable because we would then need to deprecate passing null to this parameter.

===== Backward Incompatible Changes =====

This RFC does not contain any backwards incompatible changes for the PHP 8 major release cycle.

In PHP 9, the <php>SameSite $sameSite = SameSite::Lax</php> value will be enforced.

===== Proposed PHP Version =====

Next minor version, i.e. PHP 8.3.

===== Proposed Voting Choices =====

As per the voting RFC a yes/no vote with a 2/3 majority is needed for this proposal to be accepted.

Voting started on 2022-XX-XX and will end on 2022-XX-XX.
<doodle title="Accept Add SameSite cookie attribute parameter RFC?" auth="girgias" voteType="single" closed="true">
   * Yes
   * No
</doodle>

===== Implementation =====

GitHub pull request: https://github.com/php/php-src/pull/XXXX

After the project is implemented, this section should contain

  * the version(s) it was merged into
  * a link to the git commit(s)
  * a link to the PHP manual entry for the feature

===== References =====
