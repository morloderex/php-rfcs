====== PHP RFC: Implement socket_getaddrinfo() ======
  * Version: 0.1
  * Date: 2016-08-08
  * Author: David Walker (dave@mudsite.com)
  * Status: Draft
  * First Published at: http://wiki.php.net/rfc/socket_getaddrinfo

===== Introduction =====
This RFC targets a reported feature request in [[https://bugs.php.net/bug.php?id=72733|#72733]].  The request is that PHP expose the C level function getaddrinfo().  This is a missing nice piece to the current socket library.  When dealing with IP variable networks it would be beneficial to allow libc to tell us what methods of connecting/listening would be most appropriate given a set of hints.

===== Proposal =====
The implementation[1] I'm proposing implements 4 new socket_* functions.  socket_getaddrinfo() will return an array of resources, with each resource corresponding to each returned addrinfo sockaddr.  The next two implemented methods socket_addrinfo_bind(), and socket_addrinfo_connect(), would be used to bind, or connect, to a given resource rather than make the user go through the process of creating the socket and connect/binding themselves.  The fourth function is a free'r if you'd want to free the resources before end of script.
<file php>
array    socket_getaddrinfo(string node[, mixed service, array hints])
resource socket_addrinfo_connect(sockaddrresource sockaddr)
resource socket_addrinfo_bind(sockaddrresource sockaddr)
null     socket_addrinfo_close(sockaddrresource sockaddr)
</file>

<file php>
<?php
$addrinfo = socket_getaddrinfo('127.0.0.1', 2000, array('ai_family' => AI_INET, 'ai_socktype' => SOCK_STREAM));
$sockaddr = array_shift($addrinfo);
if (!$sockaddr) die ("No Valid Socket Types");
$sock = socket_addrinfo_bind($sockaddr);
// ^^ $sock is a socket resource that is bound to 127.0.0.1:2000 using TCP/IP ready for reading
foreach ($addrinfo as $sockaddr) {
    socket_addrinfo_close($sockaddr);
}
</file>


===== Backward Incompatible Changes =====
New functionality; no BC problems here.

===== Proposed PHP Version(s) =====
Next PHP 7.x (currently 7.2)

===== RFC Impact =====
==== To SAPIs ====
None

==== To Existing Extensions ====
Socket acquired new functionality

==== To Opcache ====
None

==== New Constants ====
Exposing the AI_* family of constants.

===== Proposed Voting Choices =====
Vote to implement the new functions, would require a 2/3 majority.

===== Implementation =====

===== References =====
[1] - [[https://github.com/php/php-src/compare/master...bp1222:fix-72733|Proposed RFC Implementation]]