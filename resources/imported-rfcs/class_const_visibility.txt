====== PHP RFC: Support Class Constant Visibility ======
  * Version: 0.2
  * Date: 2015-09-13
  * Author: Sean DuBois <sean@siobud.com>, Reeze Xia <reeze@php.net>
  * Status: Discussion
  * First Published at: http://wiki.php.net/rfc/class_const_visibility


===== Introduction =====

Classes in PHP allow modifiers on properties and methods, but not constants.
It is an easily fixed inconsistency, and a feature that many want and most surprised
that it doesn't already exist.  [[http://stackoverflow.com/questions/5339456/php-class-constant-visibility|Stack Overflow Thread]]

In a thread on php-internals a couple real world examples were offered.
    * Keeping constants in a parent class private like a Database Username/Password
    * Defining bitmasks/magic numbers, but not exposing them globally 

===== Proposal =====

This RFC propose PHP support class constant visibility that mirror the behavior of method
and property visibility. 

Class constant may be define as public, private or protected. class constants declared
without any explict visibility keyword are defined as public. 

Proposed syntax:

<code php>
<?php

class Token {
	// Constants default to public
	const PUBLIC_CONST = 0;

        // Constants then also can have a defined visibility
        private const PRIVATE_CONST = 0;
        protected const PROTECTED_CONST = 0;
        public const PUBLIC_CONST_TWO = 0;
}


//Interfaces only support protected/public const, and a compile time error will be throw for privates
interface ICache {
        public const PUBLIC = 0;
	protected const PROTECTED = 0;

	public function get($k, $v);
	public function set($k);
}

</code>


===== Backward Incompatible Changes =====

==== Reflection Ext ====
The reflection extension has been updated to expose constants like [[ReflectionProperty|http://php.net/manual/en/class.reflectionproperty.php]]. 

Instead of getConstant/getConstants returning values there is now a dedicated ReflectionClassConstant class.

<code php>
<?php

class testClass  {
  const TEST_CONST = 'test';
}

$obj = new ReflectionClass( "testClass" );
$const = $obj->getConstant( "TEST_CONST" );
$const->__toString();
$const->getName();
$const->getValue();
$const->isPublic();
$const->isPrivate();
$const->isProtected();
$const->getModifiers();
$const->getDeclaringClass();
</code>

===== Proposed PHP Version(s) =====

This RFC targets PHP 7.1

===== RFC Impact =====

==== To SAPIs ====

None.

==== To Existing Extensions ====

None, all the class constant APIs will be the same.
There will be new _ex APIs that allow callers to explicitly pass flags.

If a extension accesses non-public structures (the now non-existant class_constants HashTable) there will be breakage

==== To Opcache ====

Need update.

===== Proposed Voting Choices =====

Simple Yes/No option. This requires a 2/3  majority.

===== Patches and Tests =====

A pull request has been made. It is feature complete but needs review, more tests, and help with opcache changes : https://github.com/php/php-src/pull/1494


===== References =====
  * http://php.net/manual/en/language.oop5.constants.php
  * http://php.net/manual/en/language.oop5.visibility.php

===== Changelog =====

  * V0.1 Initial version
  * V0.2 Adopted by Sean DuBois <sean@siobud.com>