====== Request for Comments: Use default_charset As Default Character Encoding ======
  * Version: 0.1
  * Date: 2012-08-30
  * Author: Yasuo Ohgaki <yohgaki@ohgaki.net>
  * Status: Under Discussion
  * First Published at: http://wiki.php.net/rfc/default_encoding

===== Introduction =====

This RFC proposes that use default_charset as default character encoding.

Current PHP does not have default encoding setting. This makes adoption of PHP 5.4 difficult, since PHP 5.4's htmlentities/htmlspecialchars is now default to UTF-8. Some applications are required to set proper encoding for htmlentities/htmlspecialchars for proper character processing. If users mixed ISO-8859-1 and UTF-8 (AND many other multibyte character encodings), it could cause security problem.

There are many encoding setting in php.ini and functions that users simply ignore and leave it alone. However, it is required to handle character encoding properly for secure programs.

===== Proposal =====

Set default_charset="UTF-8" as PHP default for both compiled and php.ini-* option.

Use default_charset as default for encoding related php.ini settings and functions.

PHP 5.4
  * leave as it is now

PHP 5.5
  * iconv.input_encoding
  * iconv.internal_encoding
  * iconv.output_encoding
  * mbstring.http_input
  * mbstring.internal_encoding
  * mbstring.http_output
  * all functions that take encoding option (e.g. htmlentities/mb_strlen/mb_regex/etc)

PHP 5.5 and master, introduce new php.ini settting. Old iconv.*/mbstring.* php.ini parameters will be removed for master.
  * php.input_encoding
  * php.internal_encoding
  * php.output_encoding

Removed from master
  * iconv.input_encoding
  * iconv.internal_encoding
  * iconv.output_encoding
  * mbstring.http_input
  * mbstring.internal_encoding
  * mbstring.http_output

Not tuoched
  * zend.script_encoding

==== Precedence of settings ====

  default_charset < php.* < mbstring.*/iconv.* < encoding specified by functions


==== Encoding name handling ====

mbstring and iconv have different level of support.

  * mbstring: http://www.php.net/manual/en/mbstring.supported-encodings.php
  * iconv: http://www.gnu.org/savannah-checkouts/gnu/libiconv/documentation/libiconv-1.13/iconv_open.3.html

Notes:

  * iconv does not have API for getting supported encoding and iconv is built with system's iconv library. 
  * mbstring has API to check encoding is supported or not.
  * users are responsible to set proper encoding name. e.g. mbstring has SJIS-win, but iconv only has SJIS

===== Patch =====

PoC Patch 
https://github.com/yohgaki/php-src/compare/master-unified-encoding-setting
===== Vote =====

Not yet

===== References =====

  * Internals discussion - http://www.serverphorums.com/read.php?7,552099,552110

===== Changelog =====

  * 2012-08-31 Initial version. (yohgaki)