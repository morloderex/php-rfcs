====== PHP RFC: Random Extension Improvement ======
  * Version: 0.1
  * Date: 2022-06-16
  * Author: Go Kudo <g-kudo@colopl.co.jp> <zeriyoshi@gmail.com>
  * Status: Draft
  * First Published at: http://wiki.php.net/rfc/rng_extension

===== Introduction =====

There are several issues with RFC: Random Extension 5.x that are already in the voting phase due to lack of proper discussion.

Key issues include:

==== Engine implementations are not final ====

The Random Extension has classes that are natively implemented as RNG engines, but they are not marked as final.
This allows classes to be created that inherit from native classes, but as stated in the previous RFC, user-implemented engines are inferior to native classes in terms of execution efficiency. This is true even for inheritance without method overrides, which often leads to confusion.

The extension already provides a Random\Engine interface with a single generate(): string method.
Even if the native classes are made final, it is easy for the user to create an alternative class using delegates.

This is clearly an API design error, and the native implementations of the interface should be marked as final.

==== Randomizer lacks array_rand() replacement method ====

array_rand() uses RNG internally, but there is no alternative method in Randomizer.
As per the previous RFC, this was the intent, but upon further investigation, array_rand() is used by many packages and should probably be drop-in replaceable.

However, the name of the method may need to be reconsidered. How about Randomizer::pickKey(array $array, int $num = 1): int|string|array or something similar?

==== PCG64 is ambiguous ====

The Random Extension has implemented PCG64 as a new PRNG, but it is officially one variant of PCG64, oneseq-128-xsl-rr-64, and may need to be made more easily understood.

In the reference implementation of PCG, this implementation seems to be called PCG64S.

==== Proposal ====

Make the following changes. 

  - Make all native engines final. 
  - (Draft) add Randomizer::pickKey(array $array, int $num = 1): int|string|array
  - Change Random\Engine\PCG64 to Random\Engine\PCG64S


===== Backward Incompatible Changes =====
none

===== Proposed PHP Version(s) =====
8.2

===== RFC Impact =====
==== To SAPIs ====
none

==== To Existing Extensions ====
none

==== To Opcache ====
none

==== New Constants ====
none

==== php.ini Defaults ====
none

===== Patches and Tests =====
currently none

===== References =====
https://externals.io/message/117939