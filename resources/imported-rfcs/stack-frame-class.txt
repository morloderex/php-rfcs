====== PHP RFC: StackFrame class ======
  * Version: 0.9
  * Date: 2020-07-07
  * Author: Micha≈Ç Brzuchalski, <brzuchal@php.net>
  * Status: Under Discussion
  * Target Version: PHP 8.0
  * First Published at: http://wiki.php.net/rfc/stack-frame-class
  * Implementation: https://github.com/php/php-src/pull/5820

===== Introduction =====
The ''debug_backtrace()'' function currently returns stack trace frames as an array of arrays with information about the file, line, class, type, object, args and function name as keys. This RFC proposes to add a ''debug_backtrace()'' alternative which returns an array of objects instead. This reduces memory usage and makes code operating on frames more readable.

===== Proposal =====
Introduce new ''StackFrame'' with static method ''getTrace()'' and optionally replace ''Exception'' class trace with 
array of ''StackFrame'' objects.

''StackFrame'' class provides properties and methods which mirrors information from ''debug_backtrace()'':

<code php>
final class StackFrame implements ArrayAccess
{
    public readonly string $file;
    
    public readonly int $line;
    
    public readonly ?string $function;
    
    public readonly ?string $class;
    
    public readonly ?object $object;
    
    public readonly array $args;
    
    public static function getTrace(): array {}

    public function getFile(): string {}

    public function getLine(): int {}

    public function getFunction(): ?string {}

    public function getClass(): ?string {}

    public function getObject(): ?object {}

    public function getType(): ?string {}

    public function getArgs(): array {}
}
</code>

==== Performance ====
On a test script with 1M recursions to produce huge result results were as above:

  - ''StackFrame::getTrace()'' execution time was 0.299s and memory usage was only **192.96MB**.
  - ''debug_backtrace()'' execution time is 0.333s which is similar but the memory usage was **390.96MB**.

===== Backward Incompatible Changes =====
If vote decides about changing ''Exception'' trace with array of ''StackTrace'' objects then ''Exception::getTrace()'' method will no longer be a mutable array of arrays with simple keys.
Although a ''StackFrame'' implements ''ArrayAccess'' interface and allow to read all keys in BC manner manipulation on frames will no longer be possible.

===== Proposed PHP Version(s) =====
Next PHP 8.0

===== RFC Impact =====
==== To SAPIs ====
None.

==== To Existing Extensions ====
None.

==== To Opcache ====
None.

==== New Constants ====
None.


===== Proposed Voting Choices =====
As this is a language in exception handling mechanism it requires 2/3 accepted.

The vote will be a simple Yes/No for ''StackFrame'' inclusion and second vote a simple Yes/No for exception trace replacement.

===== Implementation =====
  * [[https://github.com/php/php-src/pull/5820|PR]]